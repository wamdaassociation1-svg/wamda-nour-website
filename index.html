
import React, { useState, useEffect } from 'react';
import Navbar from './components/Navbar';
import Hero from './components/Hero';
import About from './components/About';
import Hub from './components/Hub';
import Registrations from './components/Registrations';
import Partners from './components/Partners';
import Footer from './components/Footer';
import Noori from './components/Noori';
import AboutPage from './components/AboutPage';
import ConferencesPage from './components/ConferencesPage';
import { Language } from './types';
import { LANGUAGES } from './constants';

/**
 * Main App Orchestrator for Wamda Nour.
 * Handles routing, language state, and global layout components.
 * Theme: Deep Navy (#050a14) & Glowing Turquoise (#00dce8).
 */
function App() {
  const [currentLang, setCurrentLang] = useState<Language>(LANGUAGES[0]);
  const [isAdmin, setIsAdmin] = useState(false);
  const [currentPage, setCurrentPage] = useState<string>('home');

  // Unified navigation handling
  useEffect(() => {
    const handleNavigation = () => {
      const path = window.location.pathname;
      const hash = window.location.hash.replace('#', '');
      
      if (path.includes('About-us.html') || hash === 'about-us') {
        setCurrentPage('about-us');
      } else if (path.includes('Conferences.html') || hash === 'conferences') {
        setCurrentPage('conferences');
      } else {
        setCurrentPage('home');
      }
      // Scroll to top on every page change for a smooth transition
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.addEventListener('hashchange', handleNavigation);
    window.addEventListener('popstate', handleNavigation);
    handleNavigation(); // Initial check on load

    return () => {
      window.removeEventListener('hashchange', handleNavigation);
      window.removeEventListener('popstate', handleNavigation);
    };
  }, []);

  const handleLanguageChange = (lang: Language) => {
    setCurrentLang(lang);
    // Dynamic RTL/LTR switching based on selection
    document.documentElement.dir = lang.code === 'AR' ? 'rtl' : 'ltr';
    document.documentElement.lang = lang.code.toLowerCase();
  };

  return (
    <div className="min-h-screen bg-[#050a14] text-white selection:bg-[#00dce8] selection:text-[#050a14] font-['Cairo'] overflow-x-hidden">
      {/* Animated Navigation Bar - Global */}
      <Navbar 
        currentLangCode={currentLang.code}
        onLanguageChange={handleLanguageChange} 
      />
      
      {/* Main Content Area */}
      <main className="relative">
        {/* Dynamic Page Rendering */}
        {currentPage === 'home' && (
          <div className="animate-in fade-in duration-700">
            {/* Home Components */}
            <Hero langCode={currentLang.code} />
            <Hub langCode={currentLang.code} />
            <About langCode={currentLang.code} />
            <Registrations langCode={currentLang.code} isAdmin={isAdmin} />
            <Partners langCode={currentLang.code} />
          </div>
        )}
        
        {currentPage === 'about-us' && (
          <div className="animate-in slide-in-from-bottom-4 fade-in duration-700">
            <AboutPage langCode={currentLang.code} />
          </div>
        )}

        {currentPage === 'conferences' && (
          <div className="animate-in slide-in-from-bottom-4 fade-in duration-700">
            <ConferencesPage langCode={currentLang.code} />
          </div>
        )}
        
        {/* Nour AI Intelligent Assistant - Global FAB */}
        <Noori langCode={currentLang.code} />
      </main>

      {/* Compact Full-Width Footer - Global */}
      <Footer langCode={currentLang.code} />
    </div>
  );
}

export default App;
